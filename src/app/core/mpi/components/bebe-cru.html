<plex-layout main="9">
    <plex-layout-main>
        <form #formulario="ngForm">
            <!-- <fieldset> -->
            <!-- <legend>Registro de Bebé</legend> -->
            <plex-tabs>
                <plex-tab label="Paciente" icon="account">
                    <fieldset>
                        <!-- <legend>Registro de Bebé</legend> -->
                        <!-- DATOS BASICOS -->
                        <div class="row">
                            <div class="col-4">
                                <plex-text label="Apellido" [(ngModel)]="bebeModel.apellido" name="apellido" [required]="true">
                                </plex-text>
                            </div>
                            <div class="col-4">
                                <plex-text label="Nombre" [(ngModel)]="bebeModel.nombre" name="nombre" [required]="true">
                                </plex-text>
                            </div>
                            <div class="col-4">
                                <plex-radio [(ngModel)]="bebeModel.sexo" label="Sexo" [data]="opcionesSexo" name="sexo"
                                    type="horizontal" [required]="true">
                                </plex-radio>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                <plex-datetime label="Fecha de Nacimiento" [max]="hoy" type="date" [readonly]="bebeModel.estado === 'validado'"
                                    (change)="disableGuardar = false; enableIgnorarGuardar = false;" [(ngModel)]="bebeModel.fechaNacimiento"
                                    name="fechaNacimiento" [required]="true">
                                </plex-datetime>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Datos de Madre o Padre</legend>

                        <span *ngIf="showBuscador; else showRelacion">
                            <div class="row">
                                <div class="col-md">
                                    <paciente-buscar label="Buscar Mamá" (searchStart)="searchStart()" (searchEnd)="searchEnd($event)"
                                        (searchClear)="searchClear()"></paciente-buscar>
                                    <paciente-listado *ngIf="pacientes && pacientes.length" [pacientes]="pacientes"
                                        [autoselect]="false" (selected)="onPacienteSelected($event)"></paciente-listado>
                                    <div *ngIf="pacientes && !pacientes.length" class="alert alert-default">
                                        ¡No se encontró ningún paciente!
                                    </div>
                                </div>
                            </div>
                        </span>

                        <ng-template #showRelacion>

                            <div class="row">
                                <div class="col-4">
                                    <plex-text label="Documento" [(ngModel)]="relacion.documento" name="documentoRelacion"
                                        [readonly]="true">
                                    </plex-text>
                                </div>
                                <div class="col-4">
                                    <plex-text label="Apellido" [(ngModel)]="relacion.apellido" name="apellidoRelacion"
                                        [readonly]="true">
                                    </plex-text>
                                </div>
                                <div class="col-4">
                                    <plex-text label="Nombre" [(ngModel)]="relacion.nombre" name="nombreRelacion"
                                        [readonly]="true">
                                    </plex-text>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <plex-radio [(ngModel)]="relacion.sexo" label="Sexo" [data]="opcionesSexo" name="sexoRelacion"
                                        type="horizontal" [readonly]="true">
                                    </plex-radio>
                                </div>
                                <div class="col-4">
                                    <plex-datetime label="Fecha de Nacimiento" [max]="hoy" type="date" [readonly]="true"
                                        (change)="disableGuardar = false; enableIgnorarGuardar = false;" [(ngModel)]="relacion.fechaNacimiento"
                                        name="fechaNacimientoRelacion">
                                    </plex-datetime>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-4">
                                    <plex-button label="Cambiar" type="info" (click)="cambiarRelacion()"></plex-button>
                                </div>
                            </div>
                        </ng-template>
                    </fieldset>

                    <fieldset>
                        <legend>Datos de domicilio</legend>

                        <div class="row">
                            <div class="col-6">
                                <plex-bool *ngIf="provinciaActual" [(ngModel)]="viveProvActual" label="¿Vive en la Provincia de {{provinciaActual.nombre}}?"
                                    name="viveProvActual" (change)="changeProvActual($event)"></plex-bool>
                            </div>
                            <div class="col-6" *ngIf="viveProvActual">
                                <plex-bool *ngIf="localidadActual" [(ngModel)]="viveLocActual" label="¿Vive en {{localidadActual.nombre}}?"
                                    name="viveLocActual" (change)="changeLocalidadActual($event)"></plex-bool>
                            </div>
                        </div>
                        <div *ngIf="viveProvActual">
                            <div class="row" *ngIf="viveLocActual">
                                <div class="col-6">
                                    <plex-text label="Dirección" [(ngModel)]="bebeModel.direccion[0].valor" name="direccion"
                                        placeholder="Ej: Avenida las Flores 1200">
                                    </plex-text>
                                </div>

                            </div>
                            <div class="row" *ngIf="!viveLocActual">
                                <div class="col">
                                    <plex-text label="Dirección" [(ngModel)]="bebeModel.direccion[0].valor" name="direccion"
                                        placeholder="Ej: Avenida las Flores 1200">
                                    </plex-text>
                                </div>
                                <div class="col">
                                    <plex-select label="Localidad" [(ngModel)]="bebeModel.direccion[0].ubicacion.localidad"
                                        name="localidad" [data]="localidades" labelField="nombre">
                                    </plex-select>
                                </div>

                            </div>
                        </div>
                        <div class="row" *ngIf="!viveProvActual">
                            <div class="col">
                                <plex-text label="Dirección" [(ngModel)]="bebeModel.direccion[0].valor" name="direccion"
                                    placeholder="Ej: Avenida las Flores 1200">
                                </plex-text>
                            </div>
                            <div class="col">
                                <plex-select label="Provincia" [(ngModel)]="bebeModel.direccion[0].ubicacion.provincia"
                                    name="provincia" [data]="provincias" labelField="nombre" (change)="loadLocalidades(bebeModel.direccion[0].ubicacion.provincia)">
                                </plex-select>
                            </div>
                            <div class="col">
                                <plex-select label="Localidad" [(ngModel)]="bebeModel.direccion[0].ubicacion.localidad"
                                    name="localidad" [data]="localidades" labelField="nombre">
                                </plex-select>
                            </div>
                        </div>
                    </fieldset>
                </plex-tab>

                <!-- NOTAS -->
                <plex-tab label="Notas" icon="file-multiple">
                    <notas-paciente [notas]="bebeModel.notas" (notasNew)="notasNotification($event)"></notas-paciente>
                </plex-tab>

            </plex-tabs>
            <!-- </fieldset> -->
        </form>
    </plex-layout-main>
    <plex-layout-sidebar>
        <paciente-panel [paciente]="bebeModel"></paciente-panel>
    </plex-layout-sidebar>
    <plex-layout-footer>
        <plex-button label="Cancelar" type="danger" position="left" (click)="cancel()"></plex-button>
        <plex-button label="Guardar" type="success" position="right" [validateForm]="formulario" (click)="save($event)"></plex-button>
    </plex-layout-footer>
</plex-layout>