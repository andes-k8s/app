<plex-layout main="9">
    <plex-layout-main>
        <header>
            <!--Botones / Acciones-->
            <div class="clearfix">
                <div class="page-title float-left">Buscador de turnos y prestaciones</div>
            </div>

            <!--Filtros-->
            <div class="row">
                <div class='col-3'>
                    <plex-datetime type="date" [(ngModel)]="fechaDesde" (change)="refreshSelection($event,'fechaDesde')"
                        name="fechaDesde" label="Desde" class="fechas" [max]="fechaHasta">
                    </plex-datetime>
                    <!-- <plex-button type="info" icon="chevron-right"></plex-button> -->
                </div>
                <div class='col-3'>
                    <plex-datetime type="date" [(ngModel)]="fechaHasta" (change)="refreshSelection($event,'fechaHasta')"
                        name="fechaHasta" label="Hasta" class="fechas" [min]="fechaDesde">
                    </plex-datetime>
                </div>
                <div class='col-4'>
                    <plex-select [(ngModel)]="prestaciones" (change)="refreshSelection($event,'prestaciones')"
                        (getData)="loadPrestaciones($event)" name="prestaciones" label="Prestación" ngModelOptions="{standalone: true}">
                    </plex-select>
                </div>
                <div class='col-2 text-right'>
                    <label>
                        <!--Spacer-->&nbsp;</label>
                    <plex-button type="default" [icon]="mostrarMasOpciones ? 'chevron-up' : 'chevron-down'" (click)="mostrarMasOpciones = !mostrarMasOpciones"></plex-button>
                </div>
            </div>
            <div class="row" *ngIf="mostrarMasOpciones">
                <div class="col-4">
                    <plex-select [(ngModel)]="profesionales" (change)="refreshSelection($event, 'profesionales')"
                        (getData)="loadEquipoSalud($event)" name="profesionales" label="Equipo de salud" placeholder="Buscar por equipo de salud"
                        labelField="apellido+' '+nombre" ngModelOptions="{standalone: true}">
                    </plex-select>
                </div>
                <div class="col-4">
                    <plex-select [(ngModel)]="financiadores" (change)="refreshSelection($event,'financiador')" name="financiador"
                        (getData)="loadFinanciadores($event)" label="Financiador" placeholder="Buscar por financiador">
                    </plex-select>
                </div>
                <div class="col-4">
                    <plex-select [(ngModel)]="estado" (change)="refreshSelection($event,'estado')" name="estado" [data]="arrayEstados"
                        label="Estado" placeholder="Buscar por estado" ngModelOptions="{standalone: true}">
                    </plex-select>
                </div>
            </div>
        </header>
        <!-- Resultados -->
        <table *ngIf="busquedas?.length" class="table table-striped table-sm">
            <thead>
                <th>Fecha</th>
                <th>Paciente</th>
                <th>Financiador</th>
                <th>Tipo de Prestación</th>
                <th>Equipo de Salud</th>
                <th>Estado</th>
            </thead>
            <tbody>
                <tr *ngFor="let busqueda of busquedas; let i=index" class="hover">
                    <td>{{busqueda.fecha | date: "dd/MM/yyyy HH:mm "}}</td>
                    <td>{{busqueda.paciente | paciente}}</td>
                    <td>{{busqueda.financiador ? busqueda.financiador.financiador: 'No posee'}}</td>
                    <td>{{busqueda.prestacion.nombre}}</td>
                    <div class="nombres-profesionales">
                        <span *ngIf="busqueda.profesionales?.length == 0" class="text-danger">Profesional
                            no asignado</span>
                        <ng-container *ngIf="busqueda.profesionales">
                            <div *ngIf="busqueda.profesionales.length > 0">{{ busqueda.profesionales |
                                enumerar:['apellido','nombre'] }}</div>
                        </ng-container>
                    </div>
                    <td>{{busqueda.estado}}</td>
                </tr>
            </tbody>
        </table>
    </plex-layout-main>
    <plex-layout-sidebar>
        <header>
            Detalle del turno / la prestación
        </header>
    </plex-layout-sidebar>
</plex-layout>
