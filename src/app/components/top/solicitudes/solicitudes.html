<form *ngIf="!showDarTurnos" class="plex-layout" #form="ngForm">
    <section>

        <div class="row">
            <!--Panel de Agendas-->
            <div class="col" *ngIf="showCargarSolicitud">
                <nueva-solicitud [tipoSolicitud]="tipoSolicitud" (newSolicitudEmitter)=afterNewSolicitud($event)> </nueva-solicitud>
            </div>
            <div class="col" *ngIf="!showCargarSolicitud">
                <plex-box>
                    <header>
                        <div class="clearfix">
                            <div class="page-title float-left">Módulo de Solicitudes</div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <plex-datetime type="date" [(ngModel)]="fechaDesde" (change)="cargarSolicitudes()" name="fechaDesde" label="Desde" class="fechas">
                                </plex-datetime>
                            </div>
                            <div class="col-3">
                                <plex-datetime type="date" [(ngModel)]="fechaHasta" (change)="cargarSolicitudes()" name="fechaHasta" label="Hasta" class="fechas">
                                </plex-datetime>
                            </div>

                        </div>
                    </header>
                    <plex-tabs>
                        <plex-tab label="Solicitudes de Entrada" icon="arrow-down-box">
                            <plex-button *ngIf="showBotonCargarSolicitud" type="info" label="Cargar Solicitud" (click)="formularioSolicitud('entrada')"></plex-button>
                            <ng-container *ngIf="!prestaciones.length">
                                <tr>
                                    <td colspan="3">
                                        <i class="mdi mdi-emoticon-sad"></i> No hay Solicitudes programadas en este rango de fechas
                                    </td>
                                </tr>
                            </ng-container>
                            <table *ngIf="prestaciones?.length && !showCargarSolicitud" class="table table-striped table-sm">
                                <thead>
                                    <th>Fecha</th>
                                    <th>Paciente</th>
                                    <th>Organización Origen</th>
                                    <th>Profesional Origen</th>
                                    <th>Tipo prestación Destino</th>
                                    <th>Profesional Destino</th>
                                    <th>Estado</th>
                                    <th>Operaciones</th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let prestacion of prestacionesEntrada; let i=index" class="hover" (click)="seleccionar(prestacionesEntrada,i)"
                                        [ngClass]="{'bg-inverse text-white': (prestacion.seleccionada===true)}">
                                        <td>{{prestacion.solicitud.fecha | date: 'dd/MM/yyyy'}}</td>
                                        <td>{{prestacion.paciente | paciente}}</td>
                                        <td *ngIf="prestacion.solicitud.organizacionOrigen">{{prestacion.solicitud.organizacionOrigen.nombre}}</td>
                                        <td *ngIf="!prestacion.solicitud.organizacionOrigen"></td>
                                        <td *ngIf="prestacion.solicitud.profesionalOrigen">{{prestacion.solicitud.profesionalOrigen | profesional}}</td>
                                        <td *ngIf="!prestacion.solicitud.profesionalOrigen"></td>
                                        <td>{{prestacion.solicitud.tipoPrestacion.term}}</td>
                                        <td>{{prestacion.solicitud.profesional | profesional}}</td>
                                        <td *ngIf="!prestacion.solicitud.turno" class="text-right estado">{{prestacion.estados[prestacion.estados.length-1].tipo}}</td>
                                        <td *ngIf="prestacion.solicitud.turno" class="text-center estado">
                                            <span class="badge badge-success">Turno dado</span>
                                        </td>
                                        <td class="text-center">
                                            <span *ngIf="darTurnoArrayEntrada[i] && prestacion?.paciente">
                                                <plex-button icon="calendar-plus" type="success" (click)="darTurno(prestacion)" title="Dar Turno">
                                                </plex-button>
                                            </span>
                                            <span *ngIf="auditarArrayEntrada[i]">
                                                <plex-button icon="calendar-plus" type="info" (click)="auditar()" title="Auditar Solicitud">
                                                </plex-button>
                                            </span>
                                            <span *ngIf="visualizarEntrada[i]">
                                                <!-- <button class="btn-info" (click)="verTurno()" title="Ver Turno">
                                                    <span class="mdi mdi-eye"></span>
                                                </button> -->

                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </plex-tab>
                        <plex-tab label="Solicitudes de Salida" icon="arrow-up-box">
                            <plex-button *ngIf="showBotonCargarSolicitud" type="info" label="Cargar Solicitud" (click)="formularioSolicitud('salida')"></plex-button>
                            <ng-container *ngIf="!prestaciones.length">
                                <tr>
                                    <td colspan="3">
                                        <i class="mdi mdi-emoticon-sad"></i> No hay Solicitudes programadas en este rango de fechas
                                    </td>
                                </tr>
                            </ng-container>
                            <table *ngIf="prestaciones?.length  && !showCargarSolicitud" class="table table-striped table-sm">
                                <thead>
                                    <th>Fecha</th>
                                    <th>Paciente</th>
                                    <th>Organización Origen</th>
                                    <th>Profesional Origen</th>
                                    <th>Tipo de prestación Destino</th>
                                    <th>Profesional Destino</th>
                                    <th>Estado</th>
                                    <th>Operaciones</th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let prestacion of prestacionesSalida; let i=index" class="hover" (click)="seleccionar(prestacionesSalida,i)"
                                        [ngClass]="{'bg-inverse text-white': (prestacion.seleccionada===true)}">

                                        <td>{{prestacion.solicitud.fecha | date: 'dd/MM/yyyy'}}</td>
                                        <td>{{prestacion.paciente | paciente}}</td>
                                        <td *ngIf="prestacion.solicitud.organizacionOrigen">{{prestacion.solicitud.organizacionOrigen.nombre}}</td>
                                        <td *ngIf="!prestacion.solicitud.organizacionOrigen"></td>
                                        <td *ngIf="prestacion.solicitud.profesionalOrigen">{{prestacion.solicitud.profesionalOrigen | profesional}}</td>
                                        <td *ngIf="!prestacion.solicitud.profesionalOrigen"></td>
                                        <td>{{prestacion.solicitud.tipoPrestacion.term}}</td>
                                        <td>{{prestacion.solicitud.profesional | profesional}}</td>
                                        <td class="text-center">
                                            <span *ngIf="auditarArraySalida[i]">
                                                <span class="badge badge-danger">Auditoría pendiente</span>
                                            </span>
                                            <span *ngIf="visualizarSalida[i]">
                                                <span class="badge badge-success">Turno Dado</span>
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <span *ngIf=" prestacion.estados[prestacion.estados.length-1].tipo == 'pendiente' && !visualizarSalida[i]">
                                                <plex-button type="danger" icon="delete" (click)="cancelar(prestacion)" title="Cancelar">
                                                </plex-button>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </plex-tab>
                    </plex-tabs>
                </plex-box>
            </div>

            <!-- SIDEBAR -->
            <div *ngIf="solicitudSeleccionada  && !showCargarSolicitud" class="col-3">
                <plex-box>
                    <header>
                        <div class="clearfix">
                            <div *ngIf="turnoSeleccionado" class="page-title float-left">Datos del Turno</div>

                        </div>
                    </header>

                    <div class="container-fluid">
                        <div class="row">
                            <div class="col">
                            </div>
                        </div>
                        <div *ngIf="turnoSeleccionado?.bloques && turnoSeleccionado?.bloques[0].turnos " class="row">
                            <div class="col">
                                <b>Fecha:</b>
                                {{ turnoSeleccionado.bloques[0].turnos[0].horaInicio | fecha }}
                                <br>
                                <b>Hora:</b>
                                {{ turnoSeleccionado.bloques[0].turnos[0].horaInicio | date: 'HH:mm' }}
                                <br>
                                <b>Organización:</b>
                                {{ turnoSeleccionado.organizacion.nombre }}
                                <br>
                                <b>Tipo de Prestación:</b>
                                {{ turnoSeleccionado.bloques[0].turnos[0].tipoPrestacion.term }}
                                <br>
                                <b>Profesional(es):</b>
                                {{ turnoSeleccionado.profesionales | enumerar:['apellido', 'nombre'] }}
                            </div>
                        </div>
                    </div>
                </plex-box>
            </div>

        </div>
    </section>
</form>

<!-- Calendario para dar turnos -->
<!-- <dar-turnos *ngIf="showDarTurnos && solicitudTurno" (cancelarDarTurno)="volverDarTurno($event)" (volverValidacion)="volverDarTurno($event)"
    [opcionesVolver]="{ label: labelVolver, componente: 'solicitudes'}" [pacienteSeleccionado]="pacienteSeleccionado" [solicitudPrestacion]="solicitudTurno"></dar-turnos> -->