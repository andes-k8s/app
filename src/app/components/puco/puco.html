<plex-layout main="9">
    <plex-layout-main>
        <header>
            <h3>Padrón de cobertura social</h3>
        </header>
        <div class="col-8 float-left">
            <div class="buscador">
                <plex-text [(ngModel)]="searchTerm" name="searchTerm" (change)="buscar()" placeholder="Ingrese DNI" [autoFocus]="autofocus"
                    prefix="<i class='mdi mdi-account-search'></i>"></plex-text>
            </div>
            <!-- Error paciente no encontrado -->
            <div *ngIf="usuarios && !usuarios.length && searchTerm && !loading && !errorSearchTerm" class="alert alert-danger">
                <i class="mdi mdi-account-alert"></i> Paciente no encontrado en este padrón.
            </div>
            <!-- Error por ingreso de caracteres -->
            <div *ngIf="errorSearchTerm && searchTerm && !loading" class="alert alert-danger">
                <i class="mdi mdi-account-alert"></i> Este campo sólo admite caracteres numéricos.
            </div>
        </div>
        <div class="col-4 float-left">
            <plex-select *ngIf="periodos.length" [(ngModel)]="periodos.nombre" name="periodoPadron" [data]="periodos" placeholder="Seleccione un periodo"
                (change)="setPeriodo($event.value)" [required]="true"></plex-select>
        </div>
        <!--Loader-->
        <plex-loader *ngIf="loading" type="ball-pulse"></plex-loader>
        <!--Tabla de resultados por SimpleQuery -->
        <table *ngIf="usuarios && usuarios.length && !errorSearchTerm && searchTerm" class="table table-striped">
            <thead>
                <tr>
                    <th>DNI</th>
                    <th>Apellido y nombre</th>
                    <th>Padrón</th>
                    <th>Otra información</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let usuario of usuarios">
                    <td *ngIf="usuario.dni; else sinDatos">
                        {{usuario.dni}}
                    </td>
                    <td *ngIf="usuario.nombre; else sinDatos">{{usuario.nombre}}</td>
                    <td *ngIf="usuario.financiador; else programaIC">
                        {{usuario.financiador}}
                    </td>
                    <td *ngIf="usuario.fechaAlta; else sinDatos">
                        Fecha de alta: {{usuario.fechaAlta}}
                    </td>
                    <ng-template #sinDatos>
                        <td>SIN DATOS</td>
                    </ng-template>
                    <ng-template #programaIC>
                        <td>Programa Incluir Salud</td>
                    </ng-template>
                    <ng-template #noTransmite>
                        <td>No</td>
                    </ng-template>
                </tr>
            </tbody>
        </table>

    </plex-layout-main>
    <plex-layout-sidebar>
        <header>
            <h3>Información</h3>
        </header>
        <plex-box>
            <div class="row">
                <div class="col">
                    <h5>PUCO</h5>
                    <p>Última actualización: {{ultimaActualizacionPuco}}</p>
                    <p>Padrones disponibles: {{listaPeriodosPuco}}</p>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col">
                    <h5>Incluir Salud</h5>
                    <p>Última actualización: {{ultimaActualizacionProfe}}</p>
                    <p>Padrones disponibles: {{listaPeriodosProfe}}</p>
                </div>
            </div>

        </plex-box>
        <div class="row float-right boton-reporte">
            <div class="col">
                <sugerencias>
                    <plex-button label='Reportar un problema' type='primary' title="Sugerencias" icon="book-open-page-variant" position="right"
                        (click)="sugerencias()"></plex-button>
                </sugerencias>
            </div>
        </div>
    </plex-layout-sidebar>

</plex-layout>