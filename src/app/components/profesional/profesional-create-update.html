<plex-layout main="8">
    <plex-layout-main>
        <div class="col-md-12">
            <fieldset>
                <legend>Datos basicos</legend>
            </fieldset>
            <form #formulario="ngForm">
                <div class="row">
                    <div class="col-md-4">
                        <plex-text label="Nombre" [(ngModel)]="profesional.nombre" name="profesional.nombre"
                                   [readonly]="validado" [required]="true">
                        </plex-text>
                    </div>
                    <div class="col-md-4">
                        <plex-text label="Apellido" [(ngModel)]="profesional.apellido" name="profesional.apellido"
                                   [readonly]="validado" [required]="true">
                        </plex-text>
                    </div>
                    <div class="col-md-4">
                        <plex-int label="Número de Documento" [(ngModel)]="profesional.documento"
                                  name="profesional.documento" [readonly]="validado" [required]="true">
                        </plex-int>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <plex-select [data]="sexos" [(ngModel)]="profesional.sexo" name='sexo'
                                     placeholder="Seleccione..." label="Sexo" [readonly]="validado" [required]="true">
                        </plex-select>
                    </div>
                    <div class="col-md-3">
                        <plex-datetime type="date" label="Fecha de nacimiento" [(ngModel)]="profesional.fechaNacimiento"
                                       name='fechaNacimiento' [required]="true" [readonly]="validado">
                        </plex-datetime>
                    </div>

                </div>

                <div class=row>
                    <div class='col'>
                        <!-- DATOS DE CONTACTO -->
                        <fieldset>
                            <legend>Datos de contacto</legend>
                            <div *ngIf="profesional.contactos">
                                <div class="row">
                                    <div class="col-10 text-right">
                                        <plex-bool [(ngModel)]="noPoseeContacto"
                                                   label="No posee ningún tipo de contacto" name="noPoseeContacto"
                                                   (change)="limpiarContacto()"></plex-bool>
                                    </div>
                                    <div class="col-2 text-right">
                                        <plex-button title="Agregar contacto" titlePosition="left" type="primary btn-sm"
                                                     icon="phone-plus" (click)="addContacto('celular', '')">
                                        </plex-button>
                                    </div>
                                </div>
                                <div class="row" *ngFor="let _unContacto of profesional.contactos; let i = index">
                                    <div class="col-4">
                                        <plex-select [(ngModel)]="_unContacto.tipo" [data]="tipoComunicacion"
                                                     name="tipo-{{i}}" [required]="i <= 0" label="Tipo">
                                        </plex-select>
                                    </div>
                                    <div class="col-4">
                                        <span *ngIf="_unContacto.tipo && _unContacto.tipo.id">
                                            <plex-text *ngIf="_unContacto.tipo.id !== 'celular'" label="Dato"
                                                       [(ngModel)]="_unContacto.valor" name="valor-{{i}}"
                                                       [required]="!noPoseeContacto && (i <= 0)">
                                            </plex-text>
                                            <plex-phone label="Número" *ngIf="_unContacto.tipo.id === 'celular'"
                                                        [(ngModel)]="_unContacto.valor" placeholder="Ej: 2990000000"
                                                        [required]="!noPoseeContacto && (i <= 0)" name="valor-{{i}}">
                                            </plex-phone>
                                        </span>
                                        <span *ngIf="_unContacto.tipo && !_unContacto.tipo.id">
                                            <plex-text *ngIf="_unContacto.tipo !== 'celular'" label="Dato"
                                                       [(ngModel)]="_unContacto.valor" name="valor-{{i}}"
                                                       [required]="!noPoseeContacto && (i <= 0)">
                                            </plex-text>
                                            <plex-phone label="Número" *ngIf="_unContacto.tipo === 'celular'"
                                                        [(ngModel)]="_unContacto.valor" placeholder="Ej: 2990000000"
                                                        [required]="!noPoseeContacto && (i <= 0)" name="valor-{{i}}">
                                            </plex-phone>
                                        </span>
                                    </div>
                                    <div class="col-2" *ngIf="i > 0">
                                        <br>
                                        <br>
                                        <plex-button label="" type="danger btn-sm" icon="close"
                                                     (click)="removeContacto(i)"></plex-button>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                </div>
            </form>
        </div>
    </plex-layout-main>
    <plex-layout-sidebar>
        <div class="row mb-1">
            <div class="col text-center">
                <img fotoPaciente class="img-thumbnail" [foto]="null">
            </div>
        </div>
        <div class="row mb-1">
            <div class="col">
                <label>Nombre y apellido</label>
                <strong *ngIf="profesional.apellido">
                    {{profesional.apellido | uppercase}}, {{profesional.nombre | uppercase}}
                </strong>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col">
                <label>Documento</label>
                <span *ngIf="profesional.documento" class="mr-1">
                    {{ profesional.documento | number }}
                </span>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col">
                <label>Fecha de nacimiento</label>
                <span *ngIf="profesional.fechaNacimiento">
                    {{ profesional.fechaNacimiento | fecha }}
                </span> |
                <span *ngIf="profesional.fechaNacimiento">
                    {{ profesional | edad }}
                </span>
            </div>
        </div>
        <div class="row mb-1">
            <div class="col">
                <label>Sexo / Género</label>
                <span *ngIf="profesional.sexo">
                    {{ profesional | sexo }}
                </span>
            </div>
        </div>
        <div class="row mb-1" *ngIf="profesional.sexo && profesional.documento">
            <div class="col">
                <plex-button type="primary btn-sm" [disabled]="validado" icon="account"
                             label="Validar con servicios de Renaper" (click)="renaperVerification(profesional)">
                </plex-button>
                <plex-button type="primary btn-sm" [disabled]="!validado" icon="undo" label="Deshacer"
                             (click)="validado = false;"></plex-button>

            </div>
        </div>

    </plex-layout-sidebar>


    <plex-layout-footer>
        <plex-button label="volver" type="danger" position="left" routerLink='/tm/profesional'></plex-button>
        <plex-button *ngIf='mostrarBtnGuardar' label="Guardar" type="success" position="right"
                     [validateForm]="formulario" (click)='save($event)'></plex-button>
    </plex-layout-footer>
</plex-layout>