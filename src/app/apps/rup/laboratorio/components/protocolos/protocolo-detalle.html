<div class="row" *ngIf="edicionDatosCabecera && seleccionPaciente" style="display: block">
    <div class="col-12">
        <label>Paciente</label>
        <pacientesSearch [bloquearCreate]="true" [modoCompleto]="false" [hideFooter]="true" (selected)="seleccionarPaciente($event)">
        </pacientesSearch>
    </div>
</div>

<ng-container *ngIf="edicionDatosCabecera && !seleccionPaciente">
    <div class="row d-inline">
        <div class="col-12">
            <span *ngIf='solicitudProtocolo.solicitudPrestacion.numeroProtocolo' class="badge badge-success" style='float: left; margin-right: 20px;'>
                <h2>{{solicitudProtocolo.solicitudPrestacion.numeroProtocolo?.numeroCompleto}}</h2>
            </span>
            <ng-container>
                <div class="row">

                    <div class="col-10">
                        <h2>{{modelo.paciente.documento}} - {{modelo.paciente.apellido}}, {{modelo.paciente.nombre}}</h2>
                        F. Nac.: {{modelo.paciente.fechaNacimiento | date: 'dd/MM/yyyy' }}, Sexo: {{modelo.paciente.sexo}}
                    </div>
                    <div class="col-2">
                        <plex-button position="left" type="warning" (click)="cambiarPaciente()">Cambiar Paciente</plex-button>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</ng-container>

<!--FIN SECCION PACIENTE-->

<!-- SECCION PROTOCOLO -->
<ng-container *ngIf="showProtocoloDetalle && !seleccionPaciente">
    <!-- ENCABEZADO DE PROTOCOLO -->
    <section class="labs-listado-item">
        <div class="row">
            <div class="col-1 centradoVerticalBtn" *ngIf='modo !=="recepcion" && !edicionDatosCabecera'>
                <plex-button class="marginRightBtn" type="info" icon="chevron-left" (click)='anterior()'></plex-button>
            </div>
            <div class="col" [ngClass]="{'centradoVerticalBtn': !edicionDatosCabecera}">
                <div class="listado-contenedor-secundario">
                    <article *ngIf='!edicionDatosCabecera' class="labs-item-numero">
                        <span *ngIf='solicitudProtocolo.solicitudPrestacion.numeroProtocolo' class="badge badge-success" style='float: left; margin-right: 20px;'>
                            <h5>
                                <i *ngIf='modelo.paciente.sexo ==="femenino"' class="mdi mdi-gender-female mdi-24px mdi-rotate-45 rosa"></i>
                                <i *ngIf='modelo.paciente.sexo ==="masculino"' class="mdi mdi-gender-male mdi-24px azul"></i>
                                {{solicitudProtocolo.solicitudPrestacion.numeroProtocolo.numeroCompleto}}
                            </h5>
                        </span>

                        <div class="row">
                            <div class="col-10">
                                <strong>Paciente: </strong>
                                {{modelo.paciente.documento}} - {{modelo.paciente.apellido}}, {{modelo.paciente.nombre}} F. Nac.: {{modelo.paciente.fechaNacimiento
                                | date: 'dd/MM/yyyy' }}, Sexo: {{modelo.paciente.sexo}}
                            </div>
                            <div class="col-2">
                                <plex-button position="left" type="warning" *ngIf='edicionDatosCabecera' (click)="cambiarPaciente()">Cambiar Paciente</plex-button>
                            </div>
                        </div>
                        <div class="row" *ngIf="mostrarMasHeader">
                            <div class="col-2">
                                <strong>F. de solicitud: </strong>
                                <p>{{ modelo.solicitud.fecha | date: 'dd/MM/yyyy' }}</p>
                            </div>
                            <div class="col-2">
                                <strong>F. toma muestra: </strong>
                                <p>{{solicitudProtocolo.solicitudPrestacion.fechaTomaMuestra | date: 'dd/MM/yyyy'}}
                                </p>
                            </div>
                            <div class="col-2">
                                <strong>Origen: </strong>
                                <p>{{ modelo.solicitud.ambitoOrigen}}</p>
                            </div>
                            <div class="col-2">
                                <strong>Servicio: </strong>
                                <p>{{solicitudProtocolo?.solicitudPrestacion?.servicio.term}}</p>
                            </div>
                            <div class="col-3">
                                <strong>Usuario:&nbsp;</strong>
                                <p>{{ modelo.createdBy?.nombreCompleto }}</p>
                            </div>A
                            <div class="col-2">
                                <strong>F. de Ejecucion:&nbsp;</strong>
                                <p>{{ modelo.ejecucion.fecha | date: 'dd/MM/yyyy' }}</p>
                            </div>
                            <div class="col-3">
                                <strong>Solicitante: </strong>
                                <p>{{ modelo.solicitud.profesional.nombre }} {{ modelo.solicitud.profesional.apellido }}</p>
                            </div>
                            <div class="col-7">
                                <strong>Efector Solicitante: </strong>
                                <p>{{ modelo.solicitud.organizacion.nombre }}</p>
                            </div>
                            <div class="col-12">
                                <strong>Diagnostico: </strong>
                                <p>{{ modelo.solicitud.registros[0]?.valor?.solicitudPrestacion.diagnostico }}</p>
                            </div>
                        </div>
                    </article>
                    <article *ngIf='edicionDatosCabecera && !seleccionPaciente' class="labs-item-numero">
                        <div class="row ml-1" style="width: 100% !important;">
                            <div class="col-2">
                                <plex-datetime type="date" [(ngModel)]="modelo.ejecucion.fecha" name="fecha" label="Fecha" [required]="true"></plex-datetime>
                            </div>
                            <div class="col-2">
                                <plex-datetime type="date" [(ngModel)]="solicitudProtocolo.solicitudPrestacion.fechaTomaMuestra" name="fechaTomaMuestra"
                                    label="F. Muestra" [required]="true"></plex-datetime>
                            </div>
                            <div class="col-2">
                                <plex-datetime type="date" [(ngModel)]="modelo.solicitud.fecha" name="fecha" label="F. solicitud" [required]="true"></plex-datetime>
                            </div>
                        </div>
                        <div class="row ml-1">

                            <div class="col-5">
                                <!-- TODO: Una vez implementado TOP cambiar modelo.solicitud.organizacion x modelo.solicitud.organizacionOrigen -->
                                <plex-select [(ngModel)]="modelo.solicitud.organizacion" [data]="organizacion" labelField="nombre" placeholder="Seleccione..."
                                    label="Efector Solicitante" [required]="true">
                                </plex-select>
                            </div>
                            <div class="col-6">
                                <!-- TODO: Una vez implementado TOP cambiar modelo.solicitud.profesional x modelo.solicitud.profesionalOrigen -->
                                <plex-select [(ngModel)]="modelo.solicitud.profesional" name="profesional" label="Profesional solicitante" (getData)="loadProfesionales($event)"
                                    placeholder="Escriba el apellido del Profesional" labelField="apellido + ' ' + nombre" [required]="true">
                                </plex-select>
                            </div>
                        </div>
                        <div class="row ml-1">
                            <div class="col-3">
                                <plex-select [(ngModel)]="modelo.solicitud.ambitoOrigen" name="ambitoOrigen" (getData)="loadOrigen($event)" label="Origen"
                                    placeholder="Seleccione el origen" [required]="true">
                                </plex-select>
                            </div>
                            <div class="col-4">
                                <plex-select [(ngModel)]="solicitudProtocolo.solicitudPrestacion.servicio" label="Servicio" placeholder="Seleccione el servicio"
                                    (getData)="loadServicios($event)" labelField='term'>
                                </plex-select>
                            </div>
                            <div class="col-2">
                                <plex-select [(ngModel)]="solicitudProtocolo.solicitudPrestacion.prioridad" name="prioridad" (getData)="loadPrioridad($event)"
                                    label="Prioridad" placeholder="Seleccione la prioridad" labelField="nombre" [required]="true">
                                </plex-select>
                            </div>

                            <!-- <div class="col-3" *ngIf='modo !== "recepcion"' >
                                                <plex-select [(ngModel)]="solicitudProtocolo.solicitudPrestacion.area" name="laboratorioInterno" label="Area"
                                                    (getData)="loadArea($event)" [required]="true"></plex-select>
                                            </div> -->
                        </div>
                    </article>
                </div>
            </div>
            <div class="col-1 centradoVerticalBtn" *ngIf='modo !== "recepcion" && !edicionDatosCabecera'>
                <plex-button *ngIf='!edicionDatosCabecera' icon="mdi mdi-toggle-switch" class="float-right mr-2 marginLeftBtn" (click)="toggleControlAuditar()"
                    title="Auditar">
                </plex-button>
                <plex-button *ngIf='!edicionDatosCabecera' icon="mdi mdi-pencil" class="float-right mr-2 marginLeftBtn" (click)="editarDatosCabecera()"
                    title="Editar datos">
                </plex-button>
            </div>
            <div class="col-1 centradoVerticalBtn" *ngIf='modo !== "recepcion" && !edicionDatosCabecera'>
                <plex-button type="info" class='float-right mr-2' icon='chevron-right' (click)='siguiente()' style='margin-left: 10px;'></plex-button>
            </div>
        </div>

        <!-- <div *ngIf='modo !=="recepcion" && modo !=="control"' class="badge-container">
                    <plex-badge type="danger" class="ml-2"> {{solicitudProtocolo.solicitudPrestacion.prioridad.nombre}} </plex-badge>
                    <plex-badge type="warning" class="ml-2"> {{modelo.estados[0].tipo}} </plex-badge>
                </div> -->


    </section>

    <!-- FIN ENCABEZADO DE PROTOCOLO -->
</ng-container>

<ng-container *ngIf='mostrarCuerpoProtocolo'>
    <plex-tabs>
        <plex-tab label="Análisis">

            <div class="row">
                <div class="col">
                    <tabla-datalle-protocolo [modo]="modo" [modelo]="modelo" [solicitudProtocolo]="solicitudProtocolo" [practicasEjecucion]="practicasEjecucion"
                        [practicasCarga]="practicasCarga">
                    </tabla-datalle-protocolo>
                </div>
            </div>

        </plex-tab>
        <plex-tab *ngIf='modo ==="recepcion" || modo ==="control"' label="Diagnostico">
            <div class="row">
                <div class="col-12">
                    <plex-text [(ngModel)]="solicitudProtocolo.solicitudPrestacion.diagnostico" label="Diagnostico" name="diagnostico" multiline="true"></plex-text>
                </div>
            </div>
        </plex-tab>
        <plex-tab label="Incidencias"></plex-tab>
    </plex-tabs>
    <!--OBSERVACIONES - RECEPCION-->
    <div class="row">
        <div *ngIf="modo === 'recepcion' || modo==='control' || modo==='carga'" class="col-12">
            <plex-text [(ngModel)]="solicitudProtocolo.solicitudPrestacion.observaciones" label="Observaciones" name="observaciones"
                multiline="true">
            </plex-text>
        </div>
        <div *ngIf="modo === 'validacion'" class="col-12">
            <b> {{solicitudProtocolo.solicitudPrestacion.observaciones}} </b>
        </div>
    </div>
</ng-container>
<!--FIN SECCION PRTOCOLO -->
